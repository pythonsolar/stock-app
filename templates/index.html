{% extends "base.html" %}

{% block content %}

<div class="container mt-4">
    <!-- หัวข้อ Product List -->
    <h1 class="mb-4">รายการสินค้า</h1>

    <!-- ฟอร์มค้นหา (Search และ Dropdown สำหรับ Category) -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <!-- ฟอร์มค้นหา -->
        <form method="GET" action="/" class="d-flex" style="flex-grow: 1; margin-right: 10px;">
            <input class="form-control me-2" type="search" name="search" placeholder="ค้นหาจากชื่อสินค้า..." aria-label="Search" value="{{ request.args.get('search','') }}">

            <!-- Dropdown สำหรับเลือก Category -->
            <select name="category" class="form-select me-2">
                <option value="">หมวดหมู่สินค้า</option>  <!-- แสดงสินค้าทุกประเภท -->
                <option value="ปั๊ม" {% if request.args.get('category') == 'ปั๊ม' %}selected{% endif %}>ปั๊ม</option>
                <option value="แผงโซล่าเซลล์" {% if request.args.get('category') == 'แผงโซล่าเซลล์' %}selected{% endif %}>แผงโซล่าเซลล์</option>
                <option value="อินเวอร์เตอร์" {% if request.args.get('category') == 'อินเวอร์เตอร์' %}selected{% endif %}>อินเวอร์เตอร์</option>
                <option value="แบตเตอรี่" {% if request.args.get('category') == 'แบตเตอรี่' %}selected{% endif %}>แบตเตอรี่</option>
                <option value="ชาร์จเจอร์" {% if request.args.get('category') == 'ชาร์จเจอร์' %}selected{% endif %}>ชาร์จเจอร์</option>
                <option value="อุปกรณ์อื่นๆ" {% if request.args.get('category') == 'อุปกรณ์อื่นๆ' %}selected{% endif %}>อุปกรณ์อื่นๆ</option>
            </select>

            <button class="btn btn-outline-success" type="submit">ค้นหา</button>
        </form>

        <!-- ปุ่ม Add New Product -->
        <a href="{{ url_for('add_product_page') }}" class="btn btn-success">เพิ่มสินค้า</a>
    </div>
    
    <!-- ตารางสินค้า -->
    <div class="table-responsive">
    <table class="table">
        <thead>
            <tr>
                <th class="text-center">ID</th> <!-- เปลี่ยนเป็น Product Code -->
                <th class="text-center">ชื่อสินค้า</th>
                <th class="text-center">จำนวน</th>
                <th class="text-center">ราคา</th>
                <th class="text-center">หมวดหมู่สินค้า</th>
                <th class="text-center">แก้ไข/ลบ</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td class="text-center">{{ product.id}}</td> <!-- เปลี่ยนจาก id เป็น product_code -->
                <td><a href="/product/{{ product.id }}" class="product-link">{{ product.name }}</a></td>
                <td>{{ "{:,.0f}".format(product.quantity) }}</td>
                <td>{{ "{:,.2f}".format(product.price) }}</td>
                <td class="text-center">{{ product.category }}</td>
                <td class="text-center">
                    <a href="/edit/{{ product.id }}" class="btn btn-primary btn-sm me-2" style="width: 50px;">แก้ไข</a>
                    <a href="/delete/{{ product.id }}" class="btn btn-danger btn-sm" style="width: 50px;" onclick="return confirmDelete();">ลบ</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
</div>

<!-- JavaScript สำหรับยืนยันการลบ -->
<script>
    function confirmDelete() {
        return confirm("คุณแน่ใจหรือไม่ว่าต้องการลบสินค้านี้?");
    }
</script>

{% endblock content %}
